{% extends 'base.html' %}
{% load static %}

{% block title %}Créer un Niveau - eSchool{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- En-tête -->
        <div class="mb-8">
            <nav class="flex mb-4" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="{% url 'academic:level_list' %}" class="text-gray-700 hover:text-blue-600 flex items-center">
                            <span class="material-icons mr-2 text-sm">grade</span>Niveaux
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <span class="material-icons text-gray-400 mx-2 text-sm">chevron_right</span>
                            <span class="text-gray-500">Créer un niveau</span>
                        </div>
                    </li>
                </ol>
            </nav>
            <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                <span class="material-icons mr-3 text-blue-600">add_circle</span>
                Créer un nouveau niveau
            </h1>
        </div>

        <!-- Formulaire -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-medium text-gray-900">Informations du niveau</h2>
            </div>
            
            <form method="post" class="px-6 py-6 space-y-6">
                {% csrf_token %}
                
                <!-- Nom du niveau -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                        Nom du niveau <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           id="name" 
                           name="name" 
                           required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Ex: CP, CE1, 6ème, Seconde, Première S...">
                    <p class="mt-1 text-sm text-gray-500">
                        Nom du niveau d'enseignement
                    </p>
                </div>
                
                <!-- Description et ordre -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Description -->
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            Description
                        </label>
                        <textarea 
                               id="description" 
                               name="description"
                               rows="4"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Description du niveau (optionnel)..."></textarea>
                        <p class="mt-1 text-sm text-gray-500">
                            Description détaillée du niveau (optionnel)
                        </p>
                    </div>
                    
                    <!-- Ordre -->
                    <div>
                        <label for="order" class="block text-sm font-medium text-gray-700 mb-2">
                            Ordre d'affichage
                        </label>
                        <input type="number" 
                               id="order" 
                               name="order" 
                               value="{{ next_order }}"
                               min="1" 
                               max="100"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <p class="mt-1 text-sm text-gray-500">
                            Position dans la liste (1 = premier)
                        </p>
                        
                        <!-- Exemples d'ordre -->
                        <div class="mt-3 p-3 bg-blue-50 rounded-md">
                            <h4 class="text-xs font-medium text-blue-800 mb-2">Exemples d'ordre :</h4>
                            <div class="text-xs text-blue-700 space-y-1">
                                <div><strong>1-5 :</strong> Maternelle (PS, MS, GS...)</div>
                                <div><strong>6-10 :</strong> Primaire (CP, CE1, CE2...)</div>
                                <div><strong>11-15 :</strong> Collège (6ème, 5ème...)</div>
                                <div><strong>16-20 :</strong> Lycée (Seconde, Première...)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Informations supplémentaires -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <span class="material-icons text-blue-400">info</span>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-blue-800">
                                Informations importantes
                            </h3>
                            <div class="mt-2 text-sm text-blue-700">
                                <ul class="list-disc pl-5 space-y-1">
                                    <li>Le nom du niveau doit être unique</li>
                                    <li>L'ordre détermine la position dans les listes déroulantes</li>
                                    <li>Vous pourrez créer des classes pour ce niveau après sa création</li>
                                    <li>La description apparaîtra dans les détails du niveau</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                    {% if not is_popup %}
                    <a href="{% url 'academic:level_list' %}" 
                       class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center">
                        <span class="material-icons mr-2 text-sm">cancel</span>
                        Annuler
                    </a>
                    {% else %}
                    <button type="button" 
                            onclick="window.close()"
                            class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center">
                        <span class="material-icons mr-2 text-sm">close</span>
                        Fermer
                    </button>
                    {% endif %}
                    <button type="submit"
                            class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center">
                        <span class="material-icons mr-2 text-sm">save</span>
                        Créer le niveau
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validation côté client
    const form = document.querySelector('form');
    const nameInput = document.getElementById('name');
    const orderInput = document.getElementById('order');
    
    form.addEventListener('submit', function(e) {
        let isValid = true;
        
        // Vérifier les champs obligatoires
        if (!nameInput.value.trim()) {
            isValid = false;
            nameInput.classList.add('border-red-500');
        } else {
            nameInput.classList.remove('border-red-500');
        }
        
        // Vérifier l'ordre
        if (orderInput.value && (parseInt(orderInput.value) < 1 || parseInt(orderInput.value) > 100)) {
            isValid = false;
            orderInput.classList.add('border-red-500');
            alert('L\'ordre doit être entre 1 et 100.');
        } else {
            orderInput.classList.remove('border-red-500');
        }
        
        if (!isValid) {
            e.preventDefault();
            if (!nameInput.value.trim()) {
                alert('Le nom du niveau est obligatoire.');
            }
        }
    });
    
    // Retirer la bordure rouge quand l'utilisateur commence à taper
    [nameInput, orderInput].forEach(input => {
        input.addEventListener('input', function() {
            this.classList.remove('border-red-500');
        });
    });
    
    // Suggestions basées sur les noms communs
    const suggestions = [
        'Petite Section (PS)', 'Moyenne Section (MS)', 'Grande Section (GS)',
        'CP', 'CE1', 'CE2', 'CM1', 'CM2',
        '6ème', '5ème', '4ème', '3ème',
        'Seconde', 'Première', 'Terminale',
        'Première S', 'Première ES', 'Première L',
        'Terminale S', 'Terminale ES', 'Terminale L'
    ];
    
    // Autocomplétion simple
    nameInput.addEventListener('input', function() {
        const value = this.value.toLowerCase();
        if (value.length > 1) {
            const matches = suggestions.filter(s => s.toLowerCase().includes(value));
            if (matches.length > 0) {
                // Simple indication dans le placeholder
                this.setAttribute('title', 'Suggestions: ' + matches.slice(0, 3).join(', '));
            }
        }
    });
});
</script>
{% endblock %}