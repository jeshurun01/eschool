{% extends 'base.html' %}
{% load static %}

{% block title %}Modifier l'√âl√®ve - {{ student.user.full_name }} - eSchool{% endblock %}

{% block content %}
{% csrf_token %}
<div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <!-- En-t√™te de page am√©lior√© -->
  <div class="mb-10">
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl p-6 shadow-lg">
      <div class="sm:flex sm:items-center">
        <div class="sm:flex-auto">
          <div class="flex items-center space-x-4">
            <!-- Avatar de l'√©l√®ve -->
            <div class="flex-shrink-0">
              {% if student.user.avatar %}
                <img class="h-16 w-16 rounded-full object-cover border-4 border-white shadow-md" src="{{ student.user.avatar.url }}" alt="{{ student.user.full_name }}">
              {% else %}
                <div class="h-16 w-16 rounded-full bg-white flex items-center justify-center border-4 border-white shadow-md">
                  <span class="text-xl font-bold text-blue-600">{{ student.user.first_name.0 }}{{ student.user.last_name.0 }}</span>
                </div>
              {% endif %}
            </div>
            <div>
              <h1 class="text-3xl font-bold text-white">‚úèÔ∏è Modifier l'√âl√®ve</h1>
              <p class="mt-2 text-blue-100">
                <span class="font-medium">{{ student.user.full_name }}</span> ‚Ä¢ Matricule: {{ student.matricule }}
              </p>
              <div class="mt-2">
                {% if student.user.is_active %}
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    Compte Actif
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                    Compte Inactif
                  </span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        <div class="mt-6 sm:mt-0 sm:ml-16 sm:flex-none">
          <a href="{% url 'accounts:student_list' %}" 
             class="inline-flex items-center justify-center rounded-lg border-2 border-white bg-white/10 backdrop-blur-sm px-6 py-3 text-sm font-medium text-white shadow-lg hover:bg-white/20 transition-all duration-200">
            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Retour √† la liste
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Formulaire d'√©dition am√©lior√© -->
  <div class="bg-white shadow-2xl rounded-2xl overflow-hidden border border-gray-100">
    <form method="post" class="divide-y divide-gray-100">
      {% csrf_token %}
      
      <!-- Informations personnelles -->
      <div class="px-8 py-8">
        <div class="flex items-center mb-6">
          <div class="bg-blue-100 rounded-lg p-3 mr-4">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-gray-900">Informations personnelles</h3>
            <p class="text-sm text-gray-500">G√©rez les informations de base de l'√©l√®ve</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Pr√©nom -->
          <div class="space-y-2">
            <label for="first_name" class="block text-sm font-semibold text-gray-700">Pr√©nom *</label>
            <input type="text" 
                   id="first_name" 
                   name="first_name" 
                   value="{{ user.first_name }}"
                   required
                   class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400">
          </div>
          
          <!-- Nom -->
          <div class="space-y-2">
            <label for="last_name" class="block text-sm font-semibold text-gray-700">Nom *</label>
            <input type="text" 
                   id="last_name" 
                   name="last_name" 
                   value="{{ user.last_name }}"
                   required
                   class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400">
          </div>
          
          <!-- Email -->
          <div class="space-y-2">
            <label for="email" class="block text-sm font-semibold text-gray-700">Adresse e-mail *</label>
            <input type="email" 
                   id="email" 
                   name="email" 
                   value="{{ user.email }}"
                   required
                   class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400">
          </div>
          
          <!-- T√©l√©phone -->
          <div class="space-y-2">
            <label for="phone" class="block text-sm font-semibold text-gray-700">T√©l√©phone</label>
            <input type="tel" 
                   id="phone" 
                   name="phone" 
                   value="{{ user.phone }}"
                   class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400">
          </div>
          
          <!-- Date de naissance -->
          <div class="space-y-2">
            <label for="date_of_birth" class="block text-sm font-semibold text-gray-700">Date de naissance</label>
            <input type="date" 
                   id="date_of_birth" 
                   name="date_of_birth" 
                   value="{{ user.date_of_birth|date:'Y-m-d' }}"
                   class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400">
          </div>
          
          <!-- Genre -->
          <div class="space-y-2">
            <label for="gender" class="block text-sm font-semibold text-gray-700">Genre</label>
            <select id="gender" 
                    name="gender"
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400">
              <option value="">-- S√©lectionner --</option>
              <option value="M" {% if user.gender == 'M' %}selected{% endif %}>Masculin</option>
              <option value="F" {% if user.gender == 'F' %}selected{% endif %}>F√©minin</option>
            </select>
          </div>
        </div>
        
        <!-- Adresse -->
        <div class="mt-8 space-y-2">
          <label for="address" class="block text-sm font-semibold text-gray-700">Adresse compl√®te</label>
          <textarea id="address" 
                    name="address" 
                    rows="3"
                    placeholder="Entrez l'adresse compl√®te de l'√©l√®ve..."
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 hover:border-gray-400 resize-none">{{ user.address }}</textarea>
        </div>
      </div>
      
      <!-- Informations scolaires -->
      <div class="px-8 py-8 bg-gray-50">
        <div class="flex items-center mb-6">
          <div class="bg-indigo-100 rounded-lg p-3 mr-4">
            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-gray-900">Informations scolaires</h3>
            <p class="text-sm text-gray-500">Param√®tres acad√©miques de l'√©l√®ve</p>
          </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Matricule -->
          <div class="space-y-2">
            <label for="matricule" class="block text-sm font-semibold text-gray-700">Matricule</label>
            <div class="relative">
              <input type="text" 
                     id="matricule" 
                     name="matricule" 
                     value="{{ student.matricule }}"
                     readonly
                     class="block w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500">üîí Le matricule ne peut pas √™tre modifi√©</p>
          </div>
          
          <!-- Classe actuelle -->
          <div class="space-y-2">
            <label for="current_class" class="block text-sm font-semibold text-gray-700">Classe actuelle</label>
            <select id="current_class" 
                    name="current_class"
                    class="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 hover:border-gray-400">
              <option value="">-- Aucune classe assign√©e --</option>
              {% for class in classes %}
                <option value="{{ class.id }}" 
                        {% if student.current_class.id == class.id %}selected{% endif %}>
                  üìö {{ class.name }} ({{ class.level.name }})
                </option>
              {% endfor %}
            </select>
          </div>
          
          <!-- Date d'inscription -->
          <div class="space-y-2">
            <label class="block text-sm font-semibold text-gray-700">Date d'inscription</label>
            <div class="relative">
              <input type="text" 
                     value="{{ student.enrollment_date|date:'d/m/Y' }}"
                     readonly
                     class="block w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
              </div>
            </div>
            <p class="text-xs text-gray-500">üìÖ Date d'inscription dans l'√©tablissement</p>
          </div>
          
          <!-- Statut -->
          <div class="space-y-2">
            <label class="block text-sm font-semibold text-gray-700">Statut du compte</label>
            <div class="p-4 rounded-lg border-2 border-dashed {% if user.is_active %}border-green-300 bg-green-50{% else %}border-red-300 bg-red-50{% endif %}">
              {% if user.is_active %}
                <div class="flex items-center">
                  <div class="bg-green-500 rounded-full p-1 mr-3">
                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-green-800">Compte Actif</p>
                    <p class="text-xs text-green-600">L'√©l√®ve peut acc√©der au syst√®me</p>
                  </div>
                </div>
              {% else %}
                <div class="flex items-center">
                  <div class="bg-red-500 rounded-full p-1 mr-3">
                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                  <div>
                    <p class="text-sm font-medium text-red-800">Compte Inactif</p>
                    <p class="text-xs text-red-600">L'√©l√®ve ne peut pas acc√©der au syst√®me</p>
                  </div>
                </div>
              {% endif %}
            </div>
            <p class="text-xs text-gray-500">‚ÑπÔ∏è Le statut peut √™tre modifi√© depuis la liste des √©l√®ves par un administrateur</p>
          </div>
        </div>
      </div>
      
      <!-- Actions am√©lior√©es -->
      <div class="px-8 py-6 bg-gradient-to-r from-gray-50 to-gray-100 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0 sm:space-x-4">
        <div class="flex items-center space-x-2 text-sm text-gray-600">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>Les champs marqu√©s d'un * sont obligatoires</span>
        </div>
        
        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 w-full sm:w-auto">
          <a href="{% url 'accounts:student_list' %}" 
             class="inline-flex items-center justify-center px-6 py-3 border-2 border-gray-300 rounded-xl shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-all duration-200 w-full sm:w-auto">
            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            Annuler
          </a>
          <button type="submit" 
                  class="inline-flex items-center justify-center px-8 py-3 border border-transparent rounded-xl shadow-lg text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transform hover:scale-105 transition-all duration-200 w-full sm:w-auto">
            <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Enregistrer les modifications
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
// Animation au chargement am√©lior√©e
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  form.classList.add('opacity-0');
  
  // Animation d'entr√©e
  setTimeout(() => {
    form.classList.remove('opacity-0');
    form.classList.add('animate-fadeInUp');
  }, 100);
  
  // Animation sur les champs de saisie
  const inputs = document.querySelectorAll('input, select, textarea');
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.parentElement.classList.add('transform', 'scale-105');
    });
    
    input.addEventListener('blur', function() {
      this.parentElement.classList.remove('transform', 'scale-105');
    });
  });
});

// Validation c√¥t√© client am√©lior√©e
document.querySelector('form').addEventListener('submit', function(e) {
  const firstName = document.getElementById('first_name').value.trim();
  const lastName = document.getElementById('last_name').value.trim();
  const email = document.getElementById('email').value.trim();
  
  // Validation des champs obligatoires
  if (!firstName || !lastName || !email) {
    e.preventDefault();
    showNotification('Veuillez remplir tous les champs obligatoires (Pr√©nom, Nom, Email).', 'error');
    return false;
  }
  
  // Validation email
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    e.preventDefault();
    showNotification('Veuillez entrer une adresse e-mail valide.', 'error');
    return false;
  }
  
  // Animation de soumission
  const submitBtn = document.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>Enregistrement...';
  submitBtn.disabled = true;
  
  showNotification('Enregistrement des modifications...', 'info');
});

// Fonction pour afficher les notifications
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full ${
    type === 'error' ? 'bg-red-500 text-white' : 
    type === 'success' ? 'bg-green-500 text-white' : 
    'bg-blue-500 text-white'
  }`;
  
  notification.innerHTML = `
    <div class="flex items-center">
      <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
        ${type === 'error' ? 
          '<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>' :
          '<path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>'
        }
      </svg>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Animation d'entr√©e
  setTimeout(() => {
    notification.classList.remove('translate-x-full');
  }, 100);
  
  // Suppression automatique
  setTimeout(() => {
    notification.classList.add('translate-x-full');
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 300);
  }, 3000);
}
</script>

<style>
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeInUp {
  animation: fadeInUp 0.6s ease-out forwards;
}

/* Effets de hover am√©lior√©s */
.transition-all {
  transition: all 0.2s ease-in-out;
}

/* Animation des champs de formulaire */
input:focus, select:focus, textarea:focus {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
}

/* Styles pour les boutons avec animation */
button:hover, a:hover {
  transform: translateY(-1px);
}

button:active, a:active {
  transform: translateY(0);
}
</style>
{% endblock %}
